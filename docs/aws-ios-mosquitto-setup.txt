# Create an IAM policy for the bridge

Summarized from https://aws.amazon.com/blogs/iot/how-to-bridge-mosquitto-mqtt-broker-to-aws-iot/

## Set up your aws config
`aws config

## Create an IOT policy that allows access to `io:*` resources
`aws iot create-policy --policy-name iot-christmas-tree --policy-document '{"Version": "2012-10-17","Statement": [{"Effect": "Allow","Action": "iot:*","Resource": "*"}]}'`

## On OS X, install mosquitto
brew install mosquitto

## Create certificates and keys
```
mkdir -p /usr/local/etc/mosquitto/certs
cd /usr/local/etc/mosquitto/certs`
aws iot create-keys-and-certificate --set-as-active --certificate-pem-outfile cert.crt --private-key-outfile private.key --public-key-outfile public.key --region us-east-1
wget https://www.symantec.com/content/en/us/enterprise/verisign/roots/VeriSign-Class%203-Public-Primary-Certification-Authority-G5.pem -O rootCA.pem
chmod 600 cert.crt private.key rootCA.pem
```

## Get the certificate ARN
`aws iot list-certificates`

## Attach the policy to your certificate
`aws iot attach-principal-policy --policy-name bay-decoration-2017 --principal <ARN>`

## Create /usr/local/etc/mosquitto/iot-christmas-tree.conf from the included file

## Replace <AWS_IOT_ENDPOINT> with
`aws iot describe-enpoint

## Run mosquitto!
mostquitto -c /usr/local/etc/mosquitto/iot-christmas-tree.conf
